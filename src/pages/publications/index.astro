---
import PageHeader from "../../components/layout/pageHeader.astro";
import Card from "../../components/ui/card/card.astro";
import CardContent from "../../components/ui/card/cardContent.astro";
import CardDescription from "../../components/ui/card/cardDescription.astro";
import CardFooter from "../../components/ui/card/cardFooter.astro";
import CardHeader from "../../components/ui/card/cardHeader.astro";
import CardTitle from "../../components/ui/card/cardTitle.astro";
import SlotButton from "../../components/ui/slotButton.astro";
import Github from "../../icons/github.astro";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import FilterAndSortPublications from "./components/filterAndSort.astro";

const mockPublications = await getCollection("publications");

if (!mockPublications || mockPublications.length === 0) {
  console.warn("No publications found in the collection.");
} else {
  console.log("Found publications:", mockPublications.length);
}

const publications = mockPublications.map((pub) => ({
  ...pub.data,
}));

const filteredAndSortedPublications = publications;
---

<Layout title="Publications">
  <div>
    <PageHeader
      title="Publications"
      description="Browse our lab's research papers and articles."
      icon={Github}
    />

    <FilterAndSortPublications />

    {
      filteredAndSortedPublications.length > 0 ? (
        <div class="space-y-6">
          {filteredAndSortedPublications.map((pub) => (
            <Card class="shadow-md hover:shadow-lg transition-shadow duration-300">
              <CardHeader>
                <CardTitle>{pub.title}</CardTitle>
                <CardDescription>{pub.authors.join(", ")}</CardDescription>
              </CardHeader>
              <CardContent>
                <p class="text-sm text-muted-foreground italic">
                  {pub.type} ({pub.year} "hola")
                </p>
                {pub.abstract && (
                  <p class="mt-2 text-sm text-foreground line-clamp-3">
                    {pub.abstract}
                  </p>
                )}
                {pub.tags && pub.tags.length > 0 && (
                  <p class="mt-2 text-xs text-muted-foreground">
                    <strong>Tags:</strong> {pub.tags.join(", ")}
                  </p>
                )}
              </CardContent>
              {pub.url && (
                <CardFooter>
                  <SlotButton variant="link" asChild class="p-0 text-primary">
                    <a
                      href={pub.url}
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      View Publication
                    </a>
                  </SlotButton>
                </CardFooter>
              )}
            </Card>
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-xl text-muted-foreground">
            No publications match your criteria.
          </p>
        </div>
      )
    }
  </div>
</Layout>
