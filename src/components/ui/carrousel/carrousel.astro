---
import Publications from "@/icons/publications.astro";
import "swiper/css";

const cards = [
  {
    title: "Research in Universidad de Talca",
    img: "/",
    href: "/publications",
    icon: Publications,
  },
  {
    title: "Innovation at Universidad de Chile",
    img: "/",
    href: "/publications",
    icon: Publications,
  },
  {
    title: "Research in Universidad de Talca",
    img: "/",
    href: "/publications",
    icon: Publications,
  },
  {
    title: "Innovation at Universidad de Chile",
    img: "/",
    href: "/publications",
    icon: Publications,
  },
];
---

<section class="swiper px-4" id="swipeContainer">
  <div class="swiper-wrapper flex gap-4 h-full">
    {
      cards.map((card) => (
        <article class="swiper-slide text-center mx-auto bg-gradient-to-br from-primary/10 via-background to-background rounded-xl border border-gray-400 h-full flex flex-col sm:min-h-[400px]">
          <figure class="flex-1 relative w-full flex flex-col justify-center items-center">
            <img
              src={card.img}
              alt={card.title}
              class="w-full aspect-video md:aspect-[3/1]  object-cover rounded-t-xl fallback-img mask-b-from-0.5"
            />
            <figcaption class="sr-only -mt-6 text-lg font-semibold text-black/80">
              {card.title}
            </figcaption>
          </figure>
        </article>
      ))
    }
  </div>

  <div class="h-10"></div>

  <div class="swiper-pagination"></div>
</section>

<style></style>

<script is:inline>
  const fallbackColors = [
    "#f87171",
    "#60a5fa",
    "#34d399",
    "#fbbf24",
    "#a78bfa",
  ];

  document.querySelectorAll(".fallback-img").forEach((img) => {
    img.onerror = () => {
      const parent = img.parentElement;
      const color =
        fallbackColors[Math.floor(Math.random() * fallbackColors.length)];

      const fallbackDiv = document.createElement("div");
      fallbackDiv.className = img.className;
      fallbackDiv.style.backgroundColor = color;
      fallbackDiv.style.display = "flex";
      fallbackDiv.style.alignItems = "center";
      fallbackDiv.style.justifyContent = "center";
      fallbackDiv.style.color = "white";
      fallbackDiv.style.fontWeight = "bold";
      fallbackDiv.innerText = img.alt || "No image";

      img.replaceWith(fallbackDiv);
    };
  });
</script>

<script>
  import Swiper from "swiper";
  import { Navigation } from "swiper/modules";
  import { Pagination } from "swiper/modules";

  import "swiper/css";
  import "swiper/css/navigation";
  import "swiper/css/pagination";

  document.addEventListener("astro:page-load", () => {
    Swiper.use([Navigation, Pagination]);

    const swiper = new Swiper("#swipeContainer", {
      slidesPerView: "auto",
      spaceBetween: 16,
      centeredSlides: false,
      grabCursor: true,
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      autoplay: {
        delay: 3000,
        disableOnInteraction: false,
      },
    });
  });
</script>
